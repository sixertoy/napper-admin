"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react"),React__default=_interopDefault(React),PropTypes=require("prop-types"),PropTypes__default=_interopDefault(PropTypes),reactRouterDom=require("react-router-dom"),Helmet=_interopDefault(require("react-helmet")),napperCore=require("@iziges/napper-core"),get=_interopDefault(require("lodash.get"));function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function ownKeys(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,r)}return a}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(a),!0).forEach(function(t){_defineProperty(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):ownKeys(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}function _objectWithoutProperties(e,t){if(null==e)return{};var a,r,n=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var Routes=PropTypes.arrayOf(PropTypes.shape({component:PropTypes__default.oneOfType([PropTypes.func,PropTypes.object]),icon:PropTypes.string,name:PropTypes.string,path:PropTypes.string})),ManifestType=PropTypes.shape({copyright:PropTypes.string.isRequired,description:PropTypes.string.isRequired,name:PropTypes.string.isRequired,version:PropTypes.string.isRequired}),QLObject=PropTypes__default.shape({create:PropTypes__default.object,mutation:PropTypes__default.object,query:PropTypes__default.object,update:PropTypes__default.func}),ActionHandlersObject=PropTypes__default.shape({onDeleteClick:PropTypes__default.func,onEditClick:PropTypes__default.func}),SmartTableColType=PropTypes__default.arrayOf(PropTypes__default.shape({classname:PropTypes__default.string,key:PropTypes__default.oneOfType([PropTypes__default.func,PropTypes__default.string]).isRequired,label:PropTypes__default.string.isRequired,primary:PropTypes__default.bool,type:PropTypes__default.oneOf(["bool","date","text"]),validate:PropTypes__default.func})),getAdminElementId=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return"napper-admin-".concat(t.join("-"))},PageHeader=function(e){var t=e.manifest;return React__default.createElement("header",{id:getAdminElementId("header")},React__default.createElement("h1",{className:"title is-uppercase is-white-text"},React__default.createElement("span",null,t.name)),React__default.createElement("h6",{className:"subtitle is-uppercase py3 px12"},React__default.createElement("small",null,t.description)),React__default.createElement("div",{className:"user align-right"}))};PageHeader.defaultProps={},PageHeader.propTypes={manifest:ManifestType.isRequired};var PageFooter=function(e){var t=e.manifest;return React__default.createElement("footer",{id:getAdminElementId("footer")},React__default.createElement("div",{className:"lh16"},React__default.createElement("span",null,t.copyright)),React__default.createElement("div",{className:"lh16"},React__default.createElement("span",null,"v".concat(t.version))))};PageFooter.propTypes={manifest:ManifestType.isRequired};var getPageTitle=function(e,t){var a=e.find(function(e){return e&&e.path===t});return a&&a.name||"Home"},getBodyClass=function(){return"home"},TITLE_PREFIX="[DEV]",TITLE_SUFFIX="Smart Admin Application",DocumentHead=function(e){var t=e.location,a=e.pages,r=t.pathname,n=getBodyClass(),o=getPageTitle(a,r),l="".concat(TITLE_PREFIX," ").concat(o," | ").concat(TITLE_SUFFIX);return React__default.createElement(Helmet,null,React__default.createElement("body",{className:n}),React__default.createElement("title",null,l))};DocumentHead.propTypes={location:PropTypes__default.shape().isRequired,pages:PropTypes__default.array.isRequired};var DocumentHead$1=reactRouterDom.withRouter(DocumentHead),parseDestination=function(e){return"/".concat(e.split("/").slice(1,2))},NavigationItem=function(e){var t=e.icon,a=e.name,r=e.path;return React__default.createElement(reactRouterDom.NavLink,{exact:!0,to:parseDestination(r),onClick:function(){},activeClassName:"active disabled",className:getAdminElementId("nav","item")},React__default.createElement("i",{className:"icon icon-".concat(t," text-center is-inline-block")}),React__default.createElement("span",{className:"label"},a))};NavigationItem.defaultProps={},NavigationItem.propTypes={icon:PropTypes__default.string.isRequired,name:PropTypes__default.string.isRequired,path:PropTypes__default.string.isRequired};var NavigationToggler=function(){return React__default.createElement("button",{type:"button",onClick:function(){},className:"is-block no-background",id:getAdminElementId("nav","toggler")})};NavigationToggler.propTypes={};var getRouteItemUniqKey=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return t&&t.filter(function(e){return"string"==typeof e}).map(function(e){return e}).join("::")},buildNavigation=function(e){return e&&e.map(function(e){return React__default.createElement(NavigationItem,e)})},toggleNavigation=function(){console.log("TODO pass a function to toggle navigation")},parseNavigationItems=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e&&e.filter(function(e){return e.icon}).filter(function(e){return e.auth===t}).map(function(e){return _objectSpread2({},e,{key:getRouteItemUniqKey("smart-admin::navigation",e.path)})})},Navigation=function(e){var t=e.pages,a=parseNavigationItems(t)||[],r=parseNavigationItems(t,!0)||[];return React__default.createElement("div",{id:getAdminElementId("navigation")},React__default.createElement("nav",{className:getAdminElementId("nav")},React__default.createElement(NavigationToggler,{toggle:toggleNavigation}),buildNavigation(a)),React__default.createElement("nav",{className:getAdminElementId("nav")},buildNavigation(r)))};Navigation.propTypes={pages:PropTypes__default.array.isRequired};var withSmartLayoutPage=function(e){return function(t){function a(){return _classCallCheck(this,a),_possibleConstructorReturn(this,_getPrototypeOf(a).apply(this,arguments))}return _inherits(a,React.PureComponent),_createClass(a,[{key:"render",value:function(){return console.log("WrappedComponent",e),React__default.createElement("div",null)}}]),a}()},renderRouterSwitch=function(e){return React__default.createElement(reactRouterDom.Switch,null,e.map(function(e){var t=e.component,a=e.path;if(!(t&&a))return null;var r={exact:void 0!==e.exact&&e.exact||!0,path:a},n="function"==typeof t,o=!!t.prototype;return n&&!o?r.render=t:r.component=t,React__default.createElement(reactRouterDom.Route,_extends({},r,{key:a}))}))},SmartLayoutPage=function(e){var t=e.children,a=e.childs,r=(e.name,e.path,e.subtitle,a&&a.length);return React__default.createElement(React__default.Fragment,null,!t&&r&&renderRouterSwitch(a),!a&&t)};SmartLayoutPage.defaultProps={children:null,childs:null,subtitle:null},SmartLayoutPage.propTypes={children:PropTypes__default.node,childs:PropTypes__default.arrayOf(PropTypes__default.shape({component:PropTypes__default.oneOfType([PropTypes__default.func,PropTypes__default.object]),exact:PropTypes__default.bool,path:PropTypes__default.string.isRequired})),name:PropTypes__default.string.isRequired,path:PropTypes__default.string.isRequired,subtitle:PropTypes__default.string};var SmartLayoutPage$1=withSmartLayoutPage(SmartLayoutPage),mergeRoutesToPages=function(e){return[].concat(_toConsumableArray(e.main.map(function(e){return _objectSpread2({},e,{auth:!1,key:e.path})})||[]),_toConsumableArray(e.auth.map(function(e){return _objectSpread2({},e,{auth:!0,key:e.path})})||[]))},markCurrentPageAsActive=function(e,t){return e.map(function(e){var a={path:e.path};return reactRouterDom.matchPath(t,a)?_objectSpread2({},e,{isActive:!0}):e})},buildLayoutPage=function(e,t){var a=e.component,r=e.path,n=_objectWithoutProperties(e,["component","path"]),o=a||SmartLayoutPage$1,l=getRouteItemUniqKey("route",r,t),u=_objectSpread2({},n,{path:r});return React__default.createElement(reactRouterDom.Route,{exact:!0,key:l,path:r,render:function(e){return React__default.createElement(o,_extends({},e,u))}})},SmartLayout=function(e){var t=e.classname,a=e.location,r=e.manifest,n=e.routes,o=a.pathname,l=mergeRoutesToPages(n);return l=markCurrentPageAsActive(l,o),React__default.createElement("div",{id:getAdminElementId("layout"),className:t},React__default.createElement(DocumentHead$1,{pages:l}),React__default.createElement("div",{className:"is-fixed shadowed flex-rows flex-between no-overflow"},React__default.createElement(Navigation,{pages:l})),React__default.createElement("div",{className:"is-full-layout flex-rows flex-between"},React__default.createElement(PageHeader,{manifest:r}),React__default.createElement("main",{className:"p20 flex-1"},React__default.createElement(reactRouterDom.Switch,null,l.map(buildLayoutPage),React__default.createElement(reactRouterDom.Redirect,{to:"/"}))),React__default.createElement(PageFooter,{manifest:r})))};SmartLayout.defaultProps={classname:""},SmartLayout.propTypes={classname:PropTypes__default.string,location:PropTypes__default.object.isRequired,manifest:ManifestType.isRequired,routes:PropTypes__default.object.isRequired};var SmartLayout$1=reactRouterDom.withRouter(SmartLayout),renderRouterSwitch$1=function(e){return React__default.createElement(reactRouterDom.Switch,null,e.map(function(e){var t=e.component,a=e.path;if(!(t&&a))return null;var r={exact:void 0!==e.exact&&e.exact||!0,path:a},n="function"==typeof t,o=!!t.prototype;return n&&!o?r.render=t:r.component=t,React__default.createElement(reactRouterDom.Route,_extends({},r,{key:a}))}))},SmartLayoutPage$2=function(e){var t=e.children,a=e.childs,r=(e.name,e.path,e.subtitle,a&&a.length);return React__default.createElement(React__default.Fragment,null,!t&&r&&renderRouterSwitch$1(a),!a&&t)};SmartLayoutPage$2.defaultProps={children:null,childs:null,subtitle:null},SmartLayoutPage$2.propTypes={children:PropTypes__default.node,childs:PropTypes__default.arrayOf(PropTypes__default.shape({component:PropTypes__default.oneOfType([PropTypes__default.func,PropTypes__default.object]),exact:PropTypes__default.bool,path:PropTypes__default.string.isRequired})),name:PropTypes__default.string.isRequired,path:PropTypes__default.string.isRequired,subtitle:PropTypes__default.string};var SmartPage=withSmartLayoutPage(SmartLayoutPage$2),resolveLinkDestination=function(e){for(var t=e.pathname,a=arguments.length,r=new Array(a>1?a-1:0),n=1;n<a;n++)r[n-1]=arguments[n];return t.split("/").filter(function(e){return e}).concat(r).join("/")},resolveColValue=function(e,t){var a="string"==typeof t.key?get(e,t.key):t.key(e);return a=t.validate?t.validate(a):a},resolveColClassname=function(e){var t=e.classname||"",a="string"==typeof e.key&&e.key,r=e.type||a||"";return"".concat(t," ").concat(r).trim()},renderValueAsIcon=function(e){return e?"check":"close"},renderActionsButton=function(e,t){return React__default.createElement("td",{key:"tbody::tr::".concat(e,"::actions")},React__default.createElement(reactRouterDom.Link,{to:"/".concat(t,"/edit"),className:""},React__default.createElement("i",{className:"icon icon-edit"}),React__default.createElement("span",null,"Edit")),React__default.createElement(reactRouterDom.Link,{to:"/".concat(t,"/delete"),className:""},React__default.createElement("i",{className:"icon icon-delete"}),React__default.createElement("span",null,"Delete")))},SmartTableRow=function(e){var t=e.cols,a=e.data,r=e.history.location,n=t.find(function(e){return e.primary}).key,o=a[n],l=resolveLinkDestination(r,o);return React__default.createElement("tr",{"data-id":o},t&&t.map(function(e){var t="bool"===e.type,r=resolveColValue(a,e),n=resolveColClassname(e);return React__default.createElement("td",{key:"tbody::tr::".concat(o,"::td::").concat(e.key),className:n},React__default.createElement(reactRouterDom.Link,{to:"".concat(l,"/edit"),className:""},t&&renderValueAsIcon(r),!t&&React__default.createElement("span",null,r)))}),renderActionsButton(o,l))};SmartTableRow.propTypes={cols:SmartTableColType.isRequired,data:PropTypes__default.shape().isRequired,history:PropTypes__default.shape().isRequired};var SmartTableRow$1=reactRouterDom.withRouter(SmartTableRow),QLObject$1=PropTypes__default.shape({create:PropTypes__default.object,mutation:PropTypes__default.object,query:PropTypes__default.object,update:PropTypes__default.func}),ActionHandlersObject$1=PropTypes__default.shape({onDeleteClick:PropTypes__default.func,onEditClick:PropTypes__default.func}),SmartTableColType$1=PropTypes__default.arrayOf(PropTypes__default.shape({classname:PropTypes__default.string,key:PropTypes__default.oneOfType([PropTypes__default.func,PropTypes__default.string]).isRequired,label:PropTypes__default.string.isRequired,primary:PropTypes__default.bool,type:PropTypes__default.oneOf(["bool","date","text"]),validate:PropTypes__default.func})),styles=function(){},SmartTable=function(e){var t=e.cols,a=e.provider,r=a.length;return React__default.createElement("div",null,React__default.createElement("table",null,React__default.createElement("caption",{className:""},React__default.createElement("span",null,r," élément(s)")),React__default.createElement("colgroup",null,t&&t.map(function(e){return React__default.createElement("col",{key:e.key})}),React__default.createElement("col",{key:"colgroup::col::actions",className:""})),React__default.createElement("thead",null,React__default.createElement("tr",null,t&&t.map(function(e,t){return React__default.createElement("th",{key:e.index||t},React__default.createElement("span",null,e.label))}),React__default.createElement("th",{key:"thead::th::actions"},React__default.createElement("span",null,"Actions")))),React__default.createElement("tbody",null,a&&a.map(function(e,a){var r=t.find(function(e){return e.primary})||t[0];if(!r)return null;var n=e[r.key];return React__default.createElement(SmartTableRow$1,{key:"tbody::tr::".concat(n),data:e,cols:t,index:a})}))))};SmartTable.propTypes={cols:SmartTableColType$1.isRequired,provider:PropTypes__default.array.isRequired};var index=napperCore.withStyles(styles)(SmartTable);exports.SmartLayout=SmartLayout$1,exports.SmartPage=SmartPage,exports.SmartTable=index,exports.withSmartLayoutPage=withSmartLayoutPage;
