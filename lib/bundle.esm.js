import{compose as e}from"redux";import{connect as t}from"react-redux";import{withRouter as n,NavLink as r,Route as a,Switch as o,Redirect as i,matchPath as c,Link as l}from"react-router-dom";import s from"react";import u,{arrayOf as p,shape as m,func as f,object as d,string as y}from"prop-types";import v from"react-helmet";import{slugify as g}from"@iziges/napper-core";import h from"lodash.get";function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function q(e,t,n){return t&&E(e.prototype,t),n&&E(e,n),e}function O(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function R(){return(R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(t){O(e,t,n[t])})}return e}function k(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&x(e,t)}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function x(e,t){return(x=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function j(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function T(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function P(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}p(m({component:u.oneOfType([f,d]),icon:y,name:y,path:y}));var C=m({copyright:y.isRequired,description:y.isRequired,name:y.isRequired,version:y.isRequired}),A=(u.shape({create:u.object,mutation:u.object,query:u.object,update:u.func}),u.shape({onDeleteClick:u.func,onEditClick:u.func}),u.arrayOf(u.shape({classname:u.string,key:u.oneOfType([u.func,u.string]).isRequired,label:u.string.isRequired,primary:u.bool,type:u.oneOf(["bool","date","text"]),validate:u.func})),function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return"napper-admin-".concat(t.join("-"))}),S=function(e){var t=e.manifest;return s.createElement("header",{id:A("header")},s.createElement("h1",{className:"title is-uppercase is-white-text"},s.createElement("span",null,t.name)),s.createElement("h6",{className:"subtitle is-uppercase py3 px12"},s.createElement("small",null,t.description)),s.createElement("div",{className:"user align-right"}))};S.defaultProps={},S.propTypes={manifest:C.isRequired};var _=function(e){var t=e.manifest;return s.createElement("footer",{id:A("footer")},s.createElement("div",{className:"lh16"},s.createElement("span",null,t.copyright)),s.createElement("div",{className:"lh16"},s.createElement("span",null,"v".concat(t.version))))};_.propTypes={manifest:C.isRequired};var D=function(e){var t=e.location,n=e.pages,r=t.pathname,a=function(e,t){var n=e.find(function(e){return e&&e.path===t});return n&&n.name||"Home"}(n,r),o="".concat("[DEV]"," ").concat(a," | ").concat("Smart Admin Application");return s.createElement(v,null,s.createElement("body",{className:"home"}),s.createElement("title",null,o))};D.propTypes={location:u.shape().isRequired,pages:u.array.isRequired};var I=n(D),z=function(e){return"/".concat(e.split("/").slice(1,2))},H=function(e){var t=e.icon,n=e.minimized,a=e.name,o=e.path,i=e.toggle;return s.createElement(r,{exact:!0,to:z(o),onClick:function(){return i(n)},activeClassName:"active disabled",className:A("nav","item")},s.createElement("i",{className:"icon icon-".concat(t," text-center is-inline-block")}),s.createElement("span",{className:"label"},a))};H.propTypes={icon:u.string.isRequired,minimized:u.bool.isRequired,name:u.string.isRequired,path:u.string.isRequired,toggle:u.func.isRequired};var V=e(n,t(function(e){return{minimized:e.showNavigation}},function(e){return{toggle:function(t){t||e({type:"SmartCore:Admin:onToggleNavigation"})}}}))(H),B=function(e){var t=e.toggle;return s.createElement("button",{type:"button",onClick:t,className:"is-block no-background",id:A("nav","toggler")})};B.propTypes={toggle:u.func.isRequired};var F=t(null,function(e){return{toggle:function(){return e({type:"SmartCore:Admin:onToggleNavigation"})}}})(B),G=function(e){return e&&e.map(function(e){return s.createElement(V,e)})},J=function(){console.log("TODO pass a function to toggle navigation")},K=function(e){var t=e.adminpages,n=e.mainpages;return s.createElement("div",{id:A("navigation")},s.createElement("nav",{className:A("nav")},s.createElement(F,{toggle:J}),G(n)),s.createElement("nav",{className:A("nav")},G(t)))};K.propTypes={adminpages:u.array.isRequired,mainpages:u.array.isRequired};var L=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter(function(e){return"string"==typeof e}).map(g).join("::")},M=function(e,t){var n=e.component,r=e.path,o=j(e,["component","path"]),i=L("route",r,t),c={config:N({},o,{path:r}),path:r};return s.createElement(a,{exact:!0,key:i,path:r,render:function(){return s.createElement(n,c)}})},Q=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e&&e.filter(function(e){return e.icon}).filter(function(e){return e.auth===t}).map(function(e){return N({},e,{key:L("smart-admin::navigation",e.path)})})},U=e(n,t(function(e,t){var n=t.pages,r=Q(n)||[];return{adminpages:Q(n,!0)||[],mainpages:r}}))(K),W=function(e){var t=e.className,n=e.manifest,r=e.pages;return s.createElement("div",{id:A("layout"),className:t},s.createElement(I,{pages:r}),s.createElement("div",{className:"is-fixed shadowed flex-rows flex-between no-overflow"},s.createElement(U,{pages:r})),s.createElement("div",{className:"is-full-layout flex-rows flex-between"},s.createElement(S,{manifest:n}),s.createElement("main",{className:"p20 flex-1"},s.createElement(o,null,r.map(M),s.createElement(i,{to:"/"}))),s.createElement(_,{manifest:n})))};W.propTypes={className:u.string.isRequired,manifest:C.isRequired,pages:u.array.isRequired};var X=e(n,t(function(e,t){var n=e.popin,r=e.showNavigation,a=t.location,o=t.routes,i=a.pathname,l=function(e){return[].concat(P(e.main.map(function(e){return N({},e,{auth:!1,key:e.path})})||[]),P(e.auth.map(function(e){return N({},e,{auth:!0,key:e.path})})||[]))}(o);return l=function(e,t){return e.map(function(e){var n={path:e.path};return c(t,n)?N({},e,{isActive:!0}):e})}(l,i),{className:function(e,t){var n=e?"popin-opened":"";return"".concat(t?"":"nav-opened"," ").concat(n)}(n,r),pages:l}}))(W),Y=function(e){var t=e.match,n=e.text,r=t.params;r&&r.id;return s.createElement("h2",{className:"is-bold"},s.createElement("span",null,n))};Y.propTypes={match:u.object.isRequired,text:u.string.isRequired};var Z=n(Y),$=function(e){var t=e.text;return s.createElement("h6",{className:"mt20"},s.createElement("span",{className:"is-bold"},t))};$.propTypes={text:u.string.isRequired};var ee=function(e){var t=e.children,n=e.name,r=e.pageId,i=e.sidebarClassname,c=e.subtitle,l=e.views;return s.createElement("div",{id:r,className:"page"},s.createElement("div",{className:"flex-columns flex-between items-center pb12 mb20 bb1"},s.createElement(Z,{text:n})),c&&s.createElement($,{text:c}),s.createElement("div",{className:"flex-columns flex-between mt20 ".concat(i)},!l&&t,l&&function(e){return e&&e.length?s.createElement(o,null,e.map(function(e){var t=e.component,n=e.path;if(!t||!n)return null;var r={exact:void 0!==e.exact&&e.exact||!0,path:n},o="function"==typeof t,i=!!t.prototype;return o&&!i?r.render=t:r.component=t,s.createElement(a,R({},r,{key:n}))})):null}(l)))};ee.defaultProps={children:null,subtitle:null,views:null},ee.propTypes={children:u.node,name:u.string.isRequired,pageId:u.string.isRequired,sidebarClassname:u.string.isRequired,subtitle:u.string,views:u.arrayOf(u.shape({component:u.oneOfType([u.func,u.object]),exact:u.bool,path:u.string.isRequired}))};var te=t(function(e,t){var n=e.showSidebar,r=t.path;return{pageId:"".concat(r,"-page"),showSidebar:n,sidebarClassname:n?"":"opened"}})(ee),ne=(u.shape({create:u.object,mutation:u.object,query:u.object,update:u.func}),u.shape({onDeleteClick:u.func,onEditClick:u.func}),u.arrayOf(u.shape({classname:u.string,key:u.oneOfType([u.func,u.string]).isRequired,label:u.string.isRequired,primary:u.bool,type:u.oneOf(["bool","date","text"]),validate:u.func}))),re="smart-datatable",ae=function(e){var t,n,r=e.cols,a=e.data,o=e.location,i=r.find(function(e){return e.primary}).key,c=a[i],u=function(e){for(var t=e.pathname,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return t.split("/").filter(function(e){return e}).concat(r).join("/")}(o,c);return s.createElement("tr",{"data-id":c},r&&r.map(function(e){var t="bool"===e.type,n=function(e,t){var n="string"==typeof t.key?h(e,t.key):t.key(e);return n=t.validate?t.validate(n):n}(a,e),r=function(e){var t=e.classname||"",n="string"==typeof e.key&&e.key,r=e.type||n||"";return"".concat(t," ").concat(r).trim()}(e);return s.createElement("td",{key:"".concat(re,"::tbody::tr::").concat(c,"::td::").concat(e.key),className:r},s.createElement(l,{to:"".concat(u,"/edit"),className:""},t&&function(e){return e?"check":"close"}(n),!t&&s.createElement("span",null,n)))}),(t=c,n=u,s.createElement("td",{key:"".concat(re,"::tbody::tr::").concat(t,"::actions")},s.createElement(l,{to:"".concat(n,"/edit"),className:""},s.createElement("i",{className:"icon icon-edit"}),s.createElement("span",null,"Edit")),s.createElement(l,{to:"".concat(n,"/delete}"),className:""},s.createElement("i",{className:"icon icon-delete"}),s.createElement("span",null,"Delete")))))};ae.propTypes={cols:ne.isRequired,data:u.object.isRequired,location:u.object.isRequired};var oe=n(ae),ie=function(e){function t(){return b(this,t),T(this,w(t).apply(this,arguments))}return k(t,s.PureComponent),q(t,[{key:"render",value:function(){var e=this.props,t=e.cols,n=e.provider,r=t.length&&t.find(function(e){return e.primary})||t[0];return r?s.createElement("tbody",null,n&&n.map(function(e,n){var a=e[r.key];return s.createElement(oe,{key:"".concat(re,"::tbody::tr::").concat(a),data:e,cols:t,index:n})})):null}}]),t}();ie.defaultProps={},ie.propTypes={cols:ne.isRequired,provider:u.array.isRequired};var ce=function(e){var t=e.cols;return s.createElement("thead",null,s.createElement("tr",null,t&&t.map(function(e,t){var n=e.index||t;return n="".concat(re,"::thead::th::").concat(n),s.createElement("th",{key:n},s.createElement("span",null,e.label))}),s.createElement("th",{key:"".concat(re,"::thead::th::actions")},s.createElement("span",null,"Actions"))))};ce.propTypes={cols:ne.isRequired};var le=function(e){var t=e.provider.length;return s.createElement("caption",{className:""},s.createElement("span",null,t," élément(s)"))};le.propTypes={provider:u.array.isRequired};var se=function(e){var t=e.cols;return s.createElement("colgroup",null,t&&t.map(function(e){var t="".concat(re,"::colgroup::col::").concat(e.key);return s.createElement("col",{key:t})}),s.createElement("col",{key:"".concat(re,"::colgroup::col::actions"),className:""}))};se.defaultProps={},se.propTypes={cols:ne.isRequired};var ue=function(e){function t(){return b(this,t),T(this,w(t).apply(this,arguments))}return k(t,s.PureComponent),q(t,[{key:"render",value:function(){var e=this.props,t=e.cols,n=e.provider;return s.createElement("div",{className:""},s.createElement("table",null,s.createElement(le,{provider:n}),s.createElement(se,{cols:t}),s.createElement(ce,{cols:t}),s.createElement(ie,{cols:t,provider:n})))}}]),t}();ue.propTypes={cols:ne.isRequired,provider:u.array.isRequired};var pe=t(null,null)(ue);export{X as SmartLayout,te as SmartPage,pe as SmartTable,ue as SmartTableComponent};
