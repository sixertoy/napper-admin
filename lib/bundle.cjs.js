"use strict";Object.defineProperty(exports,"__esModule",{value:true});function _interopDefault(ex){return ex&&typeof ex==="object"&&"default"in ex?ex["default"]:ex}var React=require("react");var React__default=_interopDefault(React);var PropTypes=require("prop-types");var PropTypes__default=_interopDefault(PropTypes);var reactRouterDom=require("react-router-dom");var Helmet=_interopDefault(require("react-helmet"));var napperCore=require("@iziges/napper-core");var get=_interopDefault(require("lodash.get"));function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _extends(){_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable});keys.push.apply(keys,symbols)}return keys}function _objectSpread2(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){_defineProperty(target,key,source[key])})}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}}return target}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass)}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _objectWithoutPropertiesLoose(source,excluded){if(source==null)return{};var target={};var sourceKeys=Object.keys(source);var key,i;for(i=0;i<sourceKeys.length;i++){key=sourceKeys[i];if(excluded.indexOf(key)>=0)continue;target[key]=source[key]}return target}function _objectWithoutProperties(source,excluded){if(source==null)return{};var target=_objectWithoutPropertiesLoose(source,excluded);var key,i;if(Object.getOwnPropertySymbols){var sourceSymbolKeys=Object.getOwnPropertySymbols(source);for(i=0;i<sourceSymbolKeys.length;i++){key=sourceSymbolKeys[i];if(excluded.indexOf(key)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(source,key))continue;target[key]=source[key]}}return target}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _possibleConstructorReturn(self,call){if(call&&(typeof call==="object"||typeof call==="function")){return call}return _assertThisInitialized(self)}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread()}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||Object.prototype.toString.call(iter)==="[object Arguments]")return Array.from(iter)}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var Routes=PropTypes.arrayOf(PropTypes.shape({component:PropTypes__default.oneOfType([PropTypes.func,PropTypes.object]),icon:PropTypes.string,name:PropTypes.string,path:PropTypes.string}));var ManifestType=PropTypes.shape({copyright:PropTypes.string.isRequired,description:PropTypes.string.isRequired,name:PropTypes.string.isRequired,version:PropTypes.string.isRequired});var QLObject=PropTypes__default.shape({create:PropTypes__default.object,mutation:PropTypes__default.object,query:PropTypes__default.object,update:PropTypes__default.func});var ActionHandlersObject=PropTypes__default.shape({onDeleteClick:PropTypes__default.func,onEditClick:PropTypes__default.func});var SmartTableColType=PropTypes__default.arrayOf(PropTypes__default.shape({classname:PropTypes__default.string,key:PropTypes__default.oneOfType([PropTypes__default.func,PropTypes__default.string]).isRequired,label:PropTypes__default.string.isRequired,primary:PropTypes__default.bool,type:PropTypes__default.oneOf(["bool","date","text"]),validate:PropTypes__default.func}));var getAdminElementId=function getAdminElementId(){for(var _len=arguments.length,strings=new Array(_len),_key=0;_key<_len;_key++){strings[_key]=arguments[_key]}return"napper-admin-".concat(strings.join("-"))};var PageHeader=function PageHeader(_ref){var manifest=_ref.manifest;return React__default.createElement("header",{id:getAdminElementId("header")},React__default.createElement("h1",{className:"title is-uppercase is-white-text"},React__default.createElement("span",null,manifest.name)),React__default.createElement("h6",{className:"subtitle is-uppercase py3 px12"},React__default.createElement("small",null,manifest.description)),React__default.createElement("div",{className:"user align-right"}))};PageHeader.defaultProps={};PageHeader.propTypes={manifest:ManifestType.isRequired};var PageFooter=function PageFooter(_ref){var manifest=_ref.manifest;return React__default.createElement("footer",{id:getAdminElementId("footer")},React__default.createElement("div",{className:"lh16"},React__default.createElement("span",null,manifest.copyright)),React__default.createElement("div",{className:"lh16"},React__default.createElement("span",null,"v".concat(manifest.version))))};PageFooter.propTypes={manifest:ManifestType.isRequired};var getPageTitle=function getPageTitle(pages,currentpath){var obj=pages.find(function(o){return o&&o.path===currentpath});var title=obj&&obj.name||"Home";return title};var getBodyClass=function getBodyClass(){return"home"};var TITLE_PREFIX="[DEV]";var TITLE_SUFFIX="Smart Admin Application";var DocumentHead=function DocumentHead(_ref){var location=_ref.location,pages=_ref.pages;var pathname=location.pathname;var bodyclass=getBodyClass();var title=getPageTitle(pages,pathname);var pagetitle="".concat(TITLE_PREFIX," ").concat(title," | ").concat(TITLE_SUFFIX);return React__default.createElement(Helmet,null,React__default.createElement("body",{className:bodyclass}),React__default.createElement("title",null,pagetitle))};DocumentHead.propTypes={location:PropTypes__default.shape().isRequired,pages:PropTypes__default.array.isRequired};var DocumentHead$1=reactRouterDom.withRouter(DocumentHead);var parseDestination=function parseDestination(path){var rootpath="/".concat(path.split("/").slice(1,2));return rootpath};var NavigationItem=function NavigationItem(_ref){var icon=_ref.icon,name=_ref.name,path=_ref.path;return React__default.createElement(reactRouterDom.NavLink,{exact:true,to:parseDestination(path),onClick:function onClick(){},activeClassName:"active disabled",className:getAdminElementId("nav","item")},React__default.createElement("i",{className:"icon icon-".concat(icon," text-center is-inline-block")}),React__default.createElement("span",{className:"label"},name))};NavigationItem.defaultProps={};NavigationItem.propTypes={icon:PropTypes__default.string.isRequired,name:PropTypes__default.string.isRequired,path:PropTypes__default.string.isRequired};var NavigationToggler=function NavigationToggler(){return React__default.createElement("button",{type:"button",onClick:function onClick(){},className:"is-block no-background",id:getAdminElementId("nav","toggler")})};NavigationToggler.propTypes={};var getRouteItemUniqKey=function getRouteItemUniqKey(){for(var _len=arguments.length,strings=new Array(_len),_key=0;_key<_len;_key++){strings[_key]=arguments[_key]}return strings&&strings.filter(function(str){return typeof str==="string"}).map(function(v){return v}).join("::")};var buildNavigation=function buildNavigation(items){return items&&items.map(function(obj){return React__default.createElement(NavigationItem,obj)})};var toggleNavigation=function toggleNavigation(){console.log("TODO pass a function to toggle navigation")};var parseNavigationItems=function parseNavigationItems(items){var filterAdminPages=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;return items&&items.filter(function(obj){return obj.icon}).filter(function(obj){return obj.auth===filterAdminPages}).map(function(obj){var key=getRouteItemUniqKey("smart-admin::navigation",obj.path);return _objectSpread2({},obj,{key:key})})};var Navigation=function Navigation(_ref){var pages=_ref.pages;var mainpages=parseNavigationItems(pages)||[];var adminpages=parseNavigationItems(pages,true)||[];return React__default.createElement("div",{id:getAdminElementId("navigation")},React__default.createElement("nav",{className:getAdminElementId("nav")},React__default.createElement(NavigationToggler,{toggle:toggleNavigation}),buildNavigation(mainpages)),React__default.createElement("nav",{className:getAdminElementId("nav")},buildNavigation(adminpages)))};Navigation.propTypes={pages:PropTypes__default.array.isRequired};var withSmartLayoutPage=function withSmartLayoutPage(WrappedComponent){var LayoutPage=function(_PureComponent){_inherits(LayoutPage,_PureComponent);function LayoutPage(){_classCallCheck(this,LayoutPage);return _possibleConstructorReturn(this,_getPrototypeOf(LayoutPage).apply(this,arguments))}_createClass(LayoutPage,[{key:"render",value:function render(){console.log("WrappedComponent",WrappedComponent);return React__default.createElement("div",null)}}]);return LayoutPage}(React.PureComponent);return LayoutPage};var renderRouterSwitch=function renderRouterSwitch(childs){return React__default.createElement(reactRouterDom.Switch,null,childs.map(function(obj){var component=obj.component,path=obj.path;var isvalid=component&&path;if(!isvalid){return null}var exact=obj.exact!==undefined&&obj.exact||true;var routeprops={exact:exact,path:path};var isfunction=typeof component==="function";var hasprototype=!!component.prototype;if(isfunction&&!hasprototype){routeprops.render=component}else{routeprops.component=component}return React__default.createElement(reactRouterDom.Route,_extends({},routeprops,{key:path}))}))};var SmartLayoutPage=function SmartLayoutPage(_ref){var children=_ref.children,childs=_ref.childs,name=_ref.name,path=_ref.path,subtitle=_ref.subtitle;var hasChilds=childs&&childs.length;return React__default.createElement(React__default.Fragment,null,!children&&hasChilds&&renderRouterSwitch(childs),!childs&&children)};SmartLayoutPage.defaultProps={children:null,childs:null,subtitle:null};SmartLayoutPage.propTypes={children:PropTypes__default.node,childs:PropTypes__default.arrayOf(PropTypes__default.shape({component:PropTypes__default.oneOfType([PropTypes__default.func,PropTypes__default.object]),exact:PropTypes__default.bool,path:PropTypes__default.string.isRequired})),name:PropTypes__default.string.isRequired,path:PropTypes__default.string.isRequired,subtitle:PropTypes__default.string};var SmartLayoutPage$1=withSmartLayoutPage(SmartLayoutPage);var mergeRoutesToPages=function mergeRoutesToPages(routes){return[].concat(_toConsumableArray(routes.main.map(function(o){return _objectSpread2({},o,{auth:false,key:o.path})})||[]),_toConsumableArray(routes.auth.map(function(o){return _objectSpread2({},o,{auth:true,key:o.path})})||[]))};var markCurrentPageAsActive=function markCurrentPageAsActive(routes,currentpath){return routes.map(function(obj){var matchOptions={path:obj.path};var matchingPath=reactRouterDom.matchPath(currentpath,matchOptions);if(!matchingPath)return obj;return _objectSpread2({},obj,{isActive:true})})};var buildLayoutPage=function buildLayoutPage(route,index){var component=route.component,path=route.path,rest=_objectWithoutProperties(route,["component","path"]);var Page=component||SmartLayoutPage$1;var key=getRouteItemUniqKey("route",path,index);var componentProps=_objectSpread2({},rest,{path:path});return React__default.createElement(reactRouterDom.Route,{exact:true,key:key,path:path,render:function render(routeProps){return React__default.createElement(Page,_extends({},routeProps,componentProps))}})};var SmartLayout=function SmartLayout(_ref){var classname=_ref.classname,location=_ref.location,manifest=_ref.manifest,routes=_ref.routes;var currentPath=location.pathname;var pages=mergeRoutesToPages(routes);pages=markCurrentPageAsActive(pages,currentPath);return React__default.createElement("div",{id:getAdminElementId("layout"),className:classname},React__default.createElement(DocumentHead$1,{pages:pages}),React__default.createElement("div",{className:"is-fixed shadowed flex-rows flex-between no-overflow"},React__default.createElement(Navigation,{pages:pages})),React__default.createElement("div",{className:"is-full-layout flex-rows flex-between"},React__default.createElement(PageHeader,{manifest:manifest}),React__default.createElement("main",{className:"p20 flex-1"},React__default.createElement(reactRouterDom.Switch,null,pages.map(buildLayoutPage),React__default.createElement(reactRouterDom.Redirect,{to:"/"}))),React__default.createElement(PageFooter,{manifest:manifest})))};SmartLayout.defaultProps={classname:""};SmartLayout.propTypes={classname:PropTypes__default.string,location:PropTypes__default.object.isRequired,manifest:ManifestType.isRequired,routes:PropTypes__default.object.isRequired};var SmartLayout$1=reactRouterDom.withRouter(SmartLayout);var renderRouterSwitch$1=function renderRouterSwitch(childs){return React__default.createElement(reactRouterDom.Switch,null,childs.map(function(obj){var component=obj.component,path=obj.path;var isvalid=component&&path;if(!isvalid){return null}var exact=obj.exact!==undefined&&obj.exact||true;var routeprops={exact:exact,path:path};var isfunction=typeof component==="function";var hasprototype=!!component.prototype;if(isfunction&&!hasprototype){routeprops.render=component}else{routeprops.component=component}return React__default.createElement(reactRouterDom.Route,_extends({},routeprops,{key:path}))}))};var SmartLayoutPage$2=function SmartLayoutPage(_ref){var children=_ref.children,childs=_ref.childs,name=_ref.name,path=_ref.path,subtitle=_ref.subtitle;var hasChilds=childs&&childs.length;return React__default.createElement(React__default.Fragment,null,!children&&hasChilds&&renderRouterSwitch$1(childs),!childs&&children)};SmartLayoutPage$2.defaultProps={children:null,childs:null,subtitle:null};SmartLayoutPage$2.propTypes={children:PropTypes__default.node,childs:PropTypes__default.arrayOf(PropTypes__default.shape({component:PropTypes__default.oneOfType([PropTypes__default.func,PropTypes__default.object]),exact:PropTypes__default.bool,path:PropTypes__default.string.isRequired})),name:PropTypes__default.string.isRequired,path:PropTypes__default.string.isRequired,subtitle:PropTypes__default.string};var SmartPage=withSmartLayoutPage(SmartLayoutPage$2);var resolveLinkDestination=function resolveLinkDestination(location){var pathname=location.pathname;for(var _len=arguments.length,rest=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++){rest[_key-1]=arguments[_key]}var result=pathname.split("/").filter(function(v){return v}).concat(rest).join("/");return result};var resolveColValue=function resolveColValue(data,col){var colvalue=typeof col.key==="string"?get(data,col.key):col.key(data);colvalue=!col.validate?colvalue:col.validate(colvalue);return colvalue};var resolveColClassname=function resolveColClassname(col){var classname=col.classname||"";var key=typeof col.key==="string"&&col.key;var type=col.type||key||"";var result="".concat(classname," ").concat(type);return result.trim()};var renderValueAsIcon=function renderValueAsIcon(colvalue){var type=colvalue&&"check"||"close";return type};var renderActionsButton=function renderActionsButton(id,baseurl){return React__default.createElement("td",{key:"tbody::tr::".concat(id,"::actions")},React__default.createElement(reactRouterDom.Link,{to:"/".concat(baseurl,"/edit"),className:""},React__default.createElement("i",{className:"icon icon-edit"}),React__default.createElement("span",null,"Edit")),React__default.createElement(reactRouterDom.Link,{to:"/".concat(baseurl,"/delete"),className:""},React__default.createElement("i",{className:"icon icon-delete"}),React__default.createElement("span",null,"Delete")))};var SmartTableRow=function SmartTableRow(_ref){var cols=_ref.cols,data=_ref.data,history=_ref.history;var location=history.location;var primaryKey=cols.find(function(obj){return obj.primary}).key;var itemid=data[primaryKey];var baseurl=resolveLinkDestination(location,itemid);return React__default.createElement("tr",{"data-id":itemid},cols&&cols.map(function(col){var useicon=col.type==="bool";var colvalue=resolveColValue(data,col);var classname=resolveColClassname(col);return React__default.createElement("td",{key:"tbody::tr::".concat(itemid,"::td::").concat(col.key),className:classname},React__default.createElement(reactRouterDom.Link,{to:"".concat(baseurl,"/edit"),className:""},useicon&&renderValueAsIcon(colvalue),!useicon&&React__default.createElement("span",null,colvalue)))}),renderActionsButton(itemid,baseurl))};SmartTableRow.propTypes={cols:SmartTableColType.isRequired,data:PropTypes__default.shape().isRequired,history:PropTypes__default.shape().isRequired};var SmartTableRow$1=reactRouterDom.withRouter(SmartTableRow);var QLObject$1=PropTypes__default.shape({create:PropTypes__default.object,mutation:PropTypes__default.object,query:PropTypes__default.object,update:PropTypes__default.func});var ActionHandlersObject$1=PropTypes__default.shape({onDeleteClick:PropTypes__default.func,onEditClick:PropTypes__default.func});var SmartTableColType$1=PropTypes__default.arrayOf(PropTypes__default.shape({classname:PropTypes__default.string,key:PropTypes__default.oneOfType([PropTypes__default.func,PropTypes__default.string]).isRequired,label:PropTypes__default.string.isRequired,primary:PropTypes__default.bool,type:PropTypes__default.oneOf(["bool","date","text"]),validate:PropTypes__default.func}));var styles=function styles(){};var SmartTable=function SmartTable(_ref){var cols=_ref.cols,provider=_ref.provider;var count=provider.length;return React__default.createElement("div",null,React__default.createElement("table",null,React__default.createElement("caption",{className:""},React__default.createElement("span",null,count," élément(s)")),React__default.createElement("colgroup",null,cols&&cols.map(function(col){return React__default.createElement("col",{key:col.key})}),React__default.createElement("col",{key:"colgroup::col::actions",className:""})),React__default.createElement("thead",null,React__default.createElement("tr",null,cols&&cols.map(function(item,index){return React__default.createElement("th",{key:item.index||index},React__default.createElement("span",null,item.label))}),React__default.createElement("th",{key:"thead::th::actions"},React__default.createElement("span",null,"Actions")))),React__default.createElement("tbody",null,provider&&provider.map(function(data,index){var primary=cols.find(function(obj){return obj.primary})||cols[0];if(!primary)return null;var itemid=data[primary.key];return React__default.createElement(SmartTableRow$1,{key:"tbody::tr::".concat(itemid),data:data,cols:cols,index:index})}))))};SmartTable.propTypes={cols:SmartTableColType$1.isRequired,provider:PropTypes__default.array.isRequired};var index=napperCore.withStyles(styles)(SmartTable);exports.SmartLayout=SmartLayout$1;exports.SmartPage=SmartPage;exports.SmartTable=index;exports.withSmartLayoutPage=withSmartLayoutPage;
