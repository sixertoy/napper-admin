"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var redux=require("redux"),reactRedux=require("react-redux"),reactRouterDom=require("react-router-dom"),React=_interopDefault(require("react")),PropTypes=require("prop-types"),PropTypes__default=_interopDefault(PropTypes),Helmet=_interopDefault(require("react-helmet")),napperCore=require("@iziges/napper-core"),get=_interopDefault(require("lodash.get"));function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}function _defineProperty(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){_defineProperty(e,t,a[t])})}return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var a,r,n={},o=Object.keys(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||(n[a]=e[a]);return n}function _objectWithoutProperties(e,t){if(null==e)return{};var a,r,n=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)a=o[r],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?_assertThisInitialized(e):t}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}var Routes=PropTypes.arrayOf(PropTypes.shape({component:PropTypes__default.oneOfType([PropTypes.func,PropTypes.object]),icon:PropTypes.string,name:PropTypes.string,path:PropTypes.string})),ManifestType=PropTypes.shape({copyright:PropTypes.string.isRequired,description:PropTypes.string.isRequired,name:PropTypes.string.isRequired,version:PropTypes.string.isRequired}),QLObject=PropTypes__default.shape({create:PropTypes__default.object,mutation:PropTypes__default.object,query:PropTypes__default.object,update:PropTypes__default.func}),ActionHandlersObject=PropTypes__default.shape({onDeleteClick:PropTypes__default.func,onEditClick:PropTypes__default.func}),SmartTableColType=PropTypes__default.arrayOf(PropTypes__default.shape({classname:PropTypes__default.string,key:PropTypes__default.oneOfType([PropTypes__default.func,PropTypes__default.string]).isRequired,label:PropTypes__default.string.isRequired,primary:PropTypes__default.bool,type:PropTypes__default.oneOf(["bool","date","text"]),validate:PropTypes__default.func})),getAdminElementId=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return"napper-admin-".concat(t.join("-"))},PageHeader=function(e){var t=e.manifest;return React.createElement("header",{id:getAdminElementId("header")},React.createElement("h1",{className:"title is-uppercase is-white-text"},React.createElement("span",null,t.name)),React.createElement("h6",{className:"subtitle is-uppercase py3 px12"},React.createElement("small",null,t.description)),React.createElement("div",{className:"user align-right"}))};PageHeader.defaultProps={},PageHeader.propTypes={manifest:ManifestType.isRequired};var PageFooter=function(e){var t=e.manifest;return React.createElement("footer",{id:getAdminElementId("footer")},React.createElement("div",{className:"lh16"},React.createElement("span",null,t.copyright)),React.createElement("div",{className:"lh16"},React.createElement("span",null,"v".concat(t.version))))};PageFooter.propTypes={manifest:ManifestType.isRequired};var getPageTitle=function(e,t){var a=e.find(function(e){return e&&e.path===t});return a&&a.name||"Home"},getBodyClass=function(){return"home"},TITLE_PREFIX="[DEV]",TITLE_SUFFIX="Smart Admin Application",DocumentHead=function(e){var t=e.location,a=e.pages,r=t.pathname,n=getBodyClass(r),o=getPageTitle(a,r),i="".concat(TITLE_PREFIX," ").concat(o," | ").concat(TITLE_SUFFIX);return React.createElement(Helmet,null,React.createElement("body",{className:n}),React.createElement("title",null,i))};DocumentHead.propTypes={location:PropTypes__default.shape().isRequired,pages:PropTypes__default.array.isRequired};var DocumentHead$1=reactRouterDom.withRouter(DocumentHead),parseDestination=function(e){return"/".concat(e.split("/").slice(1,2))},NavigationItem=function(e){var t=e.icon,a=e.minimized,r=e.name,n=e.path,o=e.toggle;return React.createElement(reactRouterDom.NavLink,{exact:!0,to:parseDestination(n),onClick:function(){return o(a)},activeClassName:"active disabled",className:getAdminElementId("nav","item")},React.createElement("i",{className:"icon icon-".concat(t," text-center is-inline-block")}),React.createElement("span",{className:"label"},r))};NavigationItem.propTypes={icon:PropTypes__default.string.isRequired,minimized:PropTypes__default.bool.isRequired,name:PropTypes__default.string.isRequired,path:PropTypes__default.string.isRequired,toggle:PropTypes__default.func.isRequired};var TOGGLE_NAVIGATION="SmartCore:Admin:onToggleNavigation",toggleNavigation=function(){return{type:TOGGLE_NAVIGATION}},mapStateToProps=function(e){return{minimized:e.showNavigation}},mapDispatchToProps=function(e){return{toggle:function(t){t||e(toggleNavigation())}}},NavigationItem$1=redux.compose(reactRouterDom.withRouter,reactRedux.connect(mapStateToProps,mapDispatchToProps))(NavigationItem),NavigationToggler=function(e){var t=e.toggle;return React.createElement("button",{type:"button",onClick:t,className:"is-block no-background",id:getAdminElementId("nav","toggler")})};NavigationToggler.propTypes={toggle:PropTypes__default.func.isRequired};var mapDispatchToProps$1=function(e){return{toggle:function(){return e(toggleNavigation())}}},NavigationToggler$1=reactRedux.connect(null,mapDispatchToProps$1)(NavigationToggler),buildNavigation=function(e){return e&&e.map(function(e){return React.createElement(NavigationItem$1,e)})},toggleNavigation$1=function(){console.log("TODO pass a function to toggle navigation")},Navigation=function(e){var t=e.adminpages,a=e.mainpages;return React.createElement("div",{id:getAdminElementId("navigation")},React.createElement("nav",{className:getAdminElementId("nav")},React.createElement(NavigationToggler$1,{toggle:toggleNavigation$1}),buildNavigation(a)),React.createElement("nav",{className:getAdminElementId("nav")},buildNavigation(t)))};Navigation.propTypes={adminpages:PropTypes__default.array.isRequired,mainpages:PropTypes__default.array.isRequired};var getRouteItemUniqKey=function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return t.filter(function(e){return"string"==typeof e}).map(napperCore.slugify).join("::")},buildSmartPage=function(e,t){var a=e.component,r=e.path,n=_objectWithoutProperties(e,["component","path"]),o=getRouteItemUniqKey("route",r,t),i={config:_objectSpread({},n,{path:r}),path:r};return React.createElement(reactRouterDom.Route,{exact:!0,key:o,path:r,render:function(){return React.createElement(a,i)}})},getClassnameStates=function(e,t){var a=e?"popin-opened":"";return"".concat(t?"":"nav-opened"," ").concat(a)},parseNavigationItems=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e&&e.filter(function(e){return e.icon}).filter(function(e){return e.auth===t}).map(function(e){return _objectSpread({},e,{key:getRouteItemUniqKey("smart-admin::navigation",e.path)})})},mapStateToProps$1=function(e,t){var a=t.pages,r=parseNavigationItems(a)||[];return{adminpages:parseNavigationItems(a,!0)||[],mainpages:r}},Navigation$1=redux.compose(reactRouterDom.withRouter,reactRedux.connect(mapStateToProps$1))(Navigation),SmartLayoutComponent=function(e){var t=e.className,a=e.manifest,r=e.pages;return React.createElement("div",{id:getAdminElementId("layout"),className:t},React.createElement(DocumentHead$1,{pages:r}),React.createElement("div",{className:"is-fixed shadowed flex-rows flex-between no-overflow"},React.createElement(Navigation$1,{pages:r})),React.createElement("div",{className:"is-full-layout flex-rows flex-between"},React.createElement(PageHeader,{manifest:a}),React.createElement("main",{className:"p20 flex-1"},React.createElement(reactRouterDom.Switch,null,r.map(buildSmartPage),React.createElement(reactRouterDom.Redirect,{to:"/"}))),React.createElement(PageFooter,{manifest:a})))};SmartLayoutComponent.propTypes={className:PropTypes__default.string.isRequired,manifest:ManifestType.isRequired,pages:PropTypes__default.array.isRequired};var mergeRoutesToPages=function(e){return[].concat(_toConsumableArray(e.main.map(function(e){return _objectSpread({},e,{auth:!1,key:e.path})})||[]),_toConsumableArray(e.auth.map(function(e){return _objectSpread({},e,{auth:!0,key:e.path})})||[]))},markCurrentPageAsActive=function(e,t){return e.map(function(e){var a={path:e.path};return reactRouterDom.matchPath(t,a)?_objectSpread({},e,{isActive:!0}):e})},mapStateToProps$2=function(e,t){var a=e.popin,r=e.showNavigation,n=t.location,o=t.routes,i=n.pathname,c=mergeRoutesToPages(o);return c=markCurrentPageAsActive(c,i),{className:getClassnameStates(a,r),pages:c}},SmartLayout=redux.compose(reactRouterDom.withRouter,reactRedux.connect(mapStateToProps$2))(SmartLayoutComponent),PageTitle=function(e){var t=e.match,a=e.text,r=t.params;r&&r.id;return React.createElement("h2",{className:"is-bold"},React.createElement("span",null,a))};PageTitle.propTypes={match:PropTypes__default.object.isRequired,text:PropTypes__default.string.isRequired};var PageTitle$1=reactRouterDom.withRouter(PageTitle),SmartPageSubtitle=function(e){var t=e.text;return React.createElement("h6",{className:"mt20"},React.createElement("span",{className:"is-bold"},t))};SmartPageSubtitle.propTypes={text:PropTypes__default.string.isRequired};var renderRouterSwitch=function(e){return e&&e.length?React.createElement(reactRouterDom.Switch,null,e.map(function(e){var t=e.component,a=e.path;if(!(t&&a))return null;var r={exact:void 0!==e.exact&&e.exact||!0,path:a},n="function"==typeof t,o=!!t.prototype;return n&&!o?r.render=t:r.component=t,React.createElement(reactRouterDom.Route,_extends({},r,{key:a}))})):null},SmartPageComponent=function(e){var t=e.children,a=e.name,r=e.pageId,n=e.sidebarClassname,o=e.subtitle,i=e.views;return React.createElement("div",{id:r,className:"page"},React.createElement("div",{className:"flex-columns flex-between items-center pb12 mb20 bb1"},React.createElement(PageTitle$1,{text:a})),o&&React.createElement(SmartPageSubtitle,{text:o}),React.createElement("div",{className:"flex-columns flex-between mt20 ".concat(n)},!i&&t,i&&renderRouterSwitch(i)))};SmartPageComponent.defaultProps={children:null,subtitle:null,views:null},SmartPageComponent.propTypes={children:PropTypes__default.node,name:PropTypes__default.string.isRequired,pageId:PropTypes__default.string.isRequired,sidebarClassname:PropTypes__default.string.isRequired,subtitle:PropTypes__default.string,views:PropTypes__default.arrayOf(PropTypes__default.shape({component:PropTypes__default.oneOfType([PropTypes__default.func,PropTypes__default.object]),exact:PropTypes__default.bool,path:PropTypes__default.string.isRequired}))};var mapStateToProps$3=function(e,t){var a=e.showSidebar,r=t.path;return{pageId:"".concat(r,"-page"),showSidebar:a,sidebarClassname:a?"":"opened"}},SmartPage=reactRedux.connect(mapStateToProps$3)(SmartPageComponent),QLObject$1=PropTypes__default.shape({create:PropTypes__default.object,mutation:PropTypes__default.object,query:PropTypes__default.object,update:PropTypes__default.func}),ActionHandlersObject$1=PropTypes__default.shape({onDeleteClick:PropTypes__default.func,onEditClick:PropTypes__default.func}),SmartTableColType$1=PropTypes__default.arrayOf(PropTypes__default.shape({classname:PropTypes__default.string,key:PropTypes__default.oneOfType([PropTypes__default.func,PropTypes__default.string]).isRequired,label:PropTypes__default.string.isRequired,primary:PropTypes__default.bool,type:PropTypes__default.oneOf(["bool","date","text"]),validate:PropTypes__default.func})),KEY_PREFIX="smart-datatable",resolveLinkDestination=function(e){for(var t=e.pathname,a=arguments.length,r=new Array(a>1?a-1:0),n=1;n<a;n++)r[n-1]=arguments[n];return t.split("/").filter(function(e){return e}).concat(r).join("/")},resolveColValue=function(e,t){var a="string"==typeof t.key?get(e,t.key):t.key(e);return a=t.validate?t.validate(a):a},resolveColClassname=function(e){var t=e.classname||"",a="string"==typeof e.key&&e.key,r=e.type||a||"";return"".concat(t," ").concat(r).trim()},renderValueAsIcon=function(e){return e?"check":"close"},renderActionsButton=function(e,t){return React.createElement("td",{key:"".concat(KEY_PREFIX,"::tbody::tr::").concat(e,"::actions")},React.createElement(reactRouterDom.Link,{to:"".concat(t,"/edit"),className:""},React.createElement("i",{className:"icon icon-edit"}),React.createElement("span",null,"Edit")),React.createElement(reactRouterDom.Link,{to:"".concat(t,"/delete}"),className:""},React.createElement("i",{className:"icon icon-delete"}),React.createElement("span",null,"Delete")))},SmartTableRow=function(e){var t=e.cols,a=e.data,r=e.location,n=t.find(function(e){return e.primary}).key,o=a[n],i=resolveLinkDestination(r,o);return React.createElement("tr",{"data-id":o},t&&t.map(function(e){var t="bool"===e.type,r=resolveColValue(a,e),n=resolveColClassname(e);return React.createElement("td",{key:"".concat(KEY_PREFIX,"::tbody::tr::").concat(o,"::td::").concat(e.key),className:n},React.createElement(reactRouterDom.Link,{to:"".concat(i,"/edit"),className:""},t&&renderValueAsIcon(r),!t&&React.createElement("span",null,r)))}),renderActionsButton(o,i))};SmartTableRow.propTypes={cols:SmartTableColType$1.isRequired,data:PropTypes__default.object.isRequired,location:PropTypes__default.object.isRequired};var SmartTableRow$1=reactRouterDom.withRouter(SmartTableRow),SmartTableTbody=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,React.PureComponent),_createClass(t,[{key:"render",value:function(){var e=this.props,t=e.cols,a=e.provider,r=t.length&&t.find(function(e){return e.primary})||t[0];return r?React.createElement("tbody",null,a&&a.map(function(e,a){var n=e[r.key];return React.createElement(SmartTableRow$1,{key:"".concat(KEY_PREFIX,"::tbody::tr::").concat(n),data:e,cols:t,index:a})})):null}}]),t}();SmartTableTbody.defaultProps={},SmartTableTbody.propTypes={cols:SmartTableColType$1.isRequired,provider:PropTypes__default.array.isRequired};var SmartTableThead=function(e){var t=e.cols;return React.createElement("thead",null,React.createElement("tr",null,t&&t.map(function(e,t){var a=e.index||t;return a="".concat(KEY_PREFIX,"::thead::th::").concat(a),React.createElement("th",{key:a},React.createElement("span",null,e.label))}),React.createElement("th",{key:"".concat(KEY_PREFIX,"::thead::th::actions")},React.createElement("span",null,"Actions"))))};SmartTableThead.propTypes={cols:SmartTableColType$1.isRequired};var SmartDatatableCaption=function(e){var t=e.provider.length;return React.createElement("caption",{className:""},React.createElement("span",null,t," élément(s)"))};SmartDatatableCaption.propTypes={provider:PropTypes__default.array.isRequired};var SmartTableColGroup=function(e){var t=e.cols;return React.createElement("colgroup",null,t&&t.map(function(e){var t="".concat(KEY_PREFIX,"::colgroup::col::").concat(e.key);return React.createElement("col",{key:t})}),React.createElement("col",{key:"".concat(KEY_PREFIX,"::colgroup::col::actions"),className:""}))};SmartTableColGroup.defaultProps={},SmartTableColGroup.propTypes={cols:SmartTableColType$1.isRequired};var SmartTableComponent=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,React.PureComponent),_createClass(t,[{key:"render",value:function(){var e=this.props,t=e.cols,a=e.provider;return React.createElement("div",{className:""},React.createElement("table",null,React.createElement(SmartDatatableCaption,{provider:a}),React.createElement(SmartTableColGroup,{cols:t}),React.createElement(SmartTableThead,{cols:t}),React.createElement(SmartTableTbody,{cols:t,provider:a})))}}]),t}();SmartTableComponent.propTypes={cols:SmartTableColType$1.isRequired,provider:PropTypes__default.array.isRequired};var mapStateToProps$4=null,mapDispatchToProps$2=null,SmartTable=reactRedux.connect(mapStateToProps$4,mapDispatchToProps$2)(SmartTableComponent);exports.SmartLayout=SmartLayout,exports.SmartPage=SmartPage,exports.SmartTable=SmartTable,exports.SmartTableComponent=SmartTableComponent;
