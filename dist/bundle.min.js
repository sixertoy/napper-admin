"use strict";function _interopDefault(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var React=_interopDefault(require("react")),PropTypes=_interopDefault(require("prop-types")),reactRedux=require("react-redux"),redux=require("redux"),reactApollo=require("react-apollo"),reactRouterDom=require("react-router-dom"),apolloLink=require("apollo-link"),apolloLinkError=require("apollo-link-error"),apolloLinkHttp=require("apollo-link-http"),apolloClient=require("apollo-client"),apolloCacheInmemory=require("apollo-cache-inmemory"),Helmet=_interopDefault(require("react-helmet"));function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),n.forEach(function(t){_defineProperty(e,t,r[t])})}return e}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}var bindMiddleware=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return redux.applyMiddleware.apply(void 0,_toConsumableArray(e))},configure=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return redux.createStore(e,t,bindMiddleware([]))},TOGGLE_SIDEBAR="SmartCore:Admin:onToggleSidebar",TOGGLE_NAVIGATION="SmartCore:Admin:onToggleNavigation",showNavigation=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];switch((arguments.length>1?arguments[1]:void 0).type){case TOGGLE_NAVIGATION:return!e;default:return e}},showSidebar=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];switch((arguments.length>1?arguments[1]:void 0).type){case TOGGLE_SIDEBAR:return!e;default:return e}},coreReducers={showNavigation:showNavigation,showSidebar:showSidebar};function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArrayLimit(e,t){var r=[],n=!0,o=!1,a=void 0;try{for(var i,c=e[Symbol.iterator]();!(n=(i=c.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{n||null==c.return||c.return()}finally{if(o)throw a}}return r}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}var NODE_ENV=process.env.NODE_ENV,isProductionEnv="production"===NODE_ENV,usedebug=!isProductionEnv,Logger={debug:function(e){usedebug&&console.log("Logger.debug message => ",e)},error:function(e){console.log("Logger.error message => ",e)},ok:function(e){console.log("Logger.ok message => ",e)},warn:function(e){console.log("Logger.warn message => ",e)}},omitTypename=function(e,t){return"__typename"===e?void 0:t},getPageTitle=function(e,t){var r=e.main.concat(e.sub||[]).find(function(e){return e.path===t});return r&&r.name||"Home"},slugify=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t="àáäâèéëêìíïîòóöôùúüûñçßÿœæŕśńṕẃǵǹḿǘẍźḧ·/_,:;",r=new RegExp(t.split("").join("|"),"g");return e&&""!==e&&e.toString().toLowerCase().replace(/\s+/g,"-").replace(r,function(e){return"aaaaeeeeiiiioooouuuuncsyoarsnpwgnmuxzh------".charAt(t.indexOf(e))}).replace(/&/g,"-and-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(/^-+/,"").replace(/-+$/,"")||""},getBodyClass=function(e){return"page-".concat(e&&slugify(e)||"home")},noopnoop=function(e){return e},omitTypenameLink=function(){return new apolloLink.ApolloLink(function(e,t){if(e.variables){var r=JSON.stringify(e.variables);e.variables=JSON.parse(r,omitTypename)}return t(e)})},reduxErrorLink=function(e){return apolloLinkError.onError(function(t){var r=t.graphQLErrors,n=t.networkError,o=t.operation,a=o.operationName,i=o.variables,c="".concat(a," => ").concat(JSON.stringify(i));if(r&&r.forEach(function(t){var r=t.message,n=t.locations,o=t.path,a=_slicedToArray(n,1)[0],i=a.column,l=a.line,s="[GraphQL error]: ".concat(r,", Path: ").concat(o,", Line: ").concat(l,", Column: ").concat(i);Logger.debug(s),e({error:[s,c],time:Date.now(),type:"graphError"})}),n){var l=n.message,s=n.statusCode,u="[Network error](".concat(s,"):  ").concat(l);Logger.debug(u),e({error:[u,c,s],time:Date.now(),type:"networkError"})}})},createClient=function(e,t){return{client:new apolloClient.ApolloClient({cache:new apolloCacheInmemory.InMemoryCache,link:apolloLink.ApolloLink.from([omitTypenameLink(),reduxErrorLink(t.dispatch),new apolloLinkHttp.HttpLink({credentials:"same-origin",uri:e})])})}};function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _typeof2(e){return(_typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return _typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":_typeof2(e)})(e)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}var renderIcon=function(e){return React.createElement("i",{className:"icon icon-".concat(e),type:e})},SmartButton=function(e){var t=e.children,r=e.className,n=e.htmlType,o=e.icon,a=e.iconPlacement,i=e.label,c=e.onClick,l="".concat(r);return o&&(l="smartadmin-button-icon ".concat(l),l="smartadmin-button-icon-".concat(a," ").concat(l)),React.createElement("button",{onClick:c,type:n||"button",className:"smartadmin-button ".concat(l)},o&&"before"===a&&renderIcon(o),!t&&i&&React.createElement("span",null,i),!i&&t,o&&"after"===a&&renderIcon(o))};SmartButton.defaultProps={children:null,className:"",htmlType:null,icon:null,iconPlacement:"before",label:null,onClick:noopnoop},SmartButton.propTypes={children:PropTypes.node,className:PropTypes.string,htmlType:PropTypes.oneOf(["button","submit","reset"]),icon:PropTypes.string,iconPlacement:PropTypes.oneOf(["after","before"]),label:PropTypes.string,onClick:PropTypes.func};var SmartButtonGroup=function(e){var t=e.children,r=e.className;return React.createElement("div",{className:"is-button-group ".concat(r)},t)};function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var r,n,o={},a=Object.keys(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||(o[r]=e[r]);return o}function _objectWithoutProperties(e,t){if(null==e)return{};var r,n,o=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)r=a[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}SmartButtonGroup.defaultProps={className:""},SmartButtonGroup.propTypes={children:PropTypes.node.isRequired,className:PropTypes.string};var SmartCancelButton=function(e){var t=e.label,r=_objectWithoutProperties(e,["label"]);return React.createElement(SmartButton,_extends({},r,{type:"danger",htmlType:"reset",icon:"close-circle",label:t||"Annuler"}))};SmartCancelButton.defaultProps={label:null,onClick:null,size:"default"},SmartCancelButton.propTypes={disabled:PropTypes.bool.isRequired,label:PropTypes.string,onClick:PropTypes.func,size:PropTypes.string};var SmartSubmitButton=function(e){var t=e.label,r=_objectWithoutProperties(e,["label"]);return React.createElement(SmartButton,_extends({},r,{icon:"save",type:"primary",htmlType:"submit",label:t||"Enregistrer"}))};SmartSubmitButton.defaultProps={disabled:!1,label:null,onClick:null,size:"default"},SmartSubmitButton.propTypes={disabled:PropTypes.bool,label:PropTypes.string,onClick:PropTypes.func,size:PropTypes.string};var SmartDeletePopin=function(e){var t=e.id,r=e.name,n=e.onClose,o=e.mutation,a=e.update;return React.createElement(reactApollo.Mutation,{mutation:o,update:a,onCompleted:n},function(e){return React.createElement("div",{id:"delete-popin",className:"popin-container p40"},React.createElement("div",{className:"popin-controls"},React.createElement(SmartButton,{icon:"close",type:"button",className:"br50",onClick:n})),React.createElement("p",{className:"align-center"},React.createElement("span",null,"Êtes vous sûr de vouloir supprimer"),React.createElement("br",null),React.createElement("b",null," ".concat(r," ")),React.createElement("span",null,"?")),React.createElement("div",{className:"align-center"},React.createElement(SmartButton,{icon:"close",label:"Annuler",onClick:n}),React.createElement(SmartButton,{type:"danger",label:"Confirmer",size:"large",icon:"delete",iconPlacement:"after",onClick:function(){return e({variables:{id:t}})}})))})};SmartDeletePopin.propTypes={id:PropTypes.string.isRequired,mutation:PropTypes.object.isRequired,name:PropTypes.string.isRequired,onClose:PropTypes.func.isRequired,update:PropTypes.func.isRequired};var toggleNavigation=function(){return{type:TOGGLE_NAVIGATION}},MenuToggler=function(e){var t=e.toggle;return React.createElement("button",{type:"button",className:"toggler is-block no-background",onClick:t})};MenuToggler.propTypes={toggle:PropTypes.func.isRequired};var mapDispatchToProps=function(e){return{toggle:function(){return e(toggleNavigation())}}},MenuToggler$1=reactRedux.connect(null,mapDispatchToProps)(MenuToggler),parseDestination=function(e){return"/".concat(e.split("/").slice(1,2))},NavigationItem=function(e){var t=e.icon,r=e.minimized,n=e.name,o=e.path,a=e.toggle;return React.createElement(reactRouterDom.NavLink,{exact:!1,to:parseDestination(o),onClick:function(){return a(r)},activeClassName:"active disabled",className:"link is-block no-overflow"},React.createElement("i",{className:"icon icon-".concat(t," text-center is-inline-block")}),React.createElement("span",{className:"label"},n))};NavigationItem.propTypes={icon:PropTypes.string.isRequired,minimized:PropTypes.bool.isRequired,name:PropTypes.string.isRequired,path:PropTypes.string.isRequired,toggle:PropTypes.func.isRequired};var mapStateToProps=function(e){return{minimized:e.showNavigation}},mapDispatchToProps$1=function(e){return{toggle:function(t){t||e(toggleNavigation())}}},NavigationItem$1=redux.compose(reactRouterDom.withRouter,reactRedux.connect(mapStateToProps,mapDispatchToProps$1))(NavigationItem),pathnameToKey=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1,n=r+1>0&&"::".concat(r+1)||"";return"".concat(e,"::").concat(t&&slugify(t).split("-").join("::")||"").concat(n)},parseNavigationItems=function(e){return e.filter(function(e){return e.icon}).map(function(e){return _objectSpread({},e,{key:pathnameToKey("smart-admin::navigation",e.path)})})},mapStateToProps$1=function(e,t){var r=e.showNavigation,n=t.location,o=t.routes,a=n.pathname,i=parseNavigationItems(o.sub);return{items:{main:parseNavigationItems(o.main),sub:i},minimized:r,path:a}},buildNavigation=function(e){return e.map(function(e){return React.createElement(NavigationItem$1,e)})},Navigation=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,_getPrototypeOf(t).apply(this,arguments))}return _inherits(t,React.PureComponent),_createClass(t,[{key:"render",value:function(){var e=this.props.items;return React.createElement("div",{id:"smartadmin-main-navigation",className:"is-fixed shadowed flex-rows flex-between no-overflow"},React.createElement("nav",{className:"row-bottom flex-rows flex-start"},React.createElement(MenuToggler$1,null),buildNavigation(e.main)),React.createElement("nav",{className:"row-bottom flex-rows flex-end"},buildNavigation(e.sub)))}}]),t}();Navigation.propTypes={items:PropTypes.object.isRequired};var Navigation$1=redux.compose(reactRouterDom.withRouter,reactRedux.connect(mapStateToProps$1))(Navigation),LayoutHeader=function(e){var t=e.manifest;return React.createElement(React.Fragment,null,React.createElement("h1",{className:"title is-uppercase is-white-text"},React.createElement("span",null,t.name)),React.createElement("h6",{className:"subtitle is-uppercase py3 px12"},React.createElement("small",null,t.description)),React.createElement("div",{className:"user align-right"}))};LayoutHeader.defaultProps={},LayoutHeader.propTypes={manifest:PropTypes.object.isRequired};var LayoutFooter=function(e){var t=e.manifest;return React.createElement(React.Fragment,null,React.createElement("div",{className:"lh16"},React.createElement("span",null,t.copyright)),React.createElement("div",{className:"lh16"},React.createElement("span",null,"v".concat(t.version))))};LayoutFooter.propTypes={manifest:PropTypes.object.isRequired};var TITLE_PREFIX=usedebug?"[DEV]":"",TITLE_SUFFIX="Smart Admin Application",DocumentHead=function(e){var t=e.location,r=e.routes,n=t.pathname,o=getBodyClass(n),a=getPageTitle(r,n),i="".concat(TITLE_PREFIX," ").concat(a," | ").concat(TITLE_SUFFIX);return React.createElement(Helmet,null,React.createElement("body",{className:o}),React.createElement("title",null,i))};DocumentHead.propTypes={location:PropTypes.object.isRequired,routes:PropTypes.object.isRequired};var DocumentHead$1=reactRouterDom.withRouter(DocumentHead),buildSmartPage=function(e){var t=e.component,r=e.path,n=_objectWithoutProperties(e,["component","path"]),o=pathnameToKey("route",r),a={config:_objectSpread({},n,{path:r}),path:r};return React.createElement(reactRouterDom.Route,{exact:!0,key:o,path:r,render:function(){return React.createElement(t,a)}})},getClassnameStates=function(e,t){var r=e?"popin-opened":"";return"".concat(t?"":"nav-opened"," ").concat(r)},SmartLayoutPagesContainer=function(e){var t=e.routes,r=[].concat(_toConsumableArray(t.main||[]),_toConsumableArray(t.sub||[]));return React.createElement(reactRouterDom.Switch,null,r.map(buildSmartPage),React.createElement(reactRouterDom.Redirect,{to:"/dashboard"}))};SmartLayoutPagesContainer.defaultProps={},SmartLayoutPagesContainer.propTypes={routes:PropTypes.object.isRequired};var mapStateToProps$2=function(e){var t=e.showNavigation,r=e.popin;return{className:getClassnameStates(r,t),minimized:t,popin:r}},SmartAdminMainLayout=function(e){var t=e.manifest,r=e.routes,n=e.className;return React.createElement("div",{id:"smartadmin-main-layout",className:"flex-1 is-full-layout ".concat(n)},React.createElement(DocumentHead$1,{routes:r}),React.createElement("div",{id:"smartadmin-main-navigation",className:"is-fixed shadowed flex-rows flex-between no-overflow"},React.createElement(Navigation$1,{routes:r})),React.createElement("div",{className:"is-full-layout flex-rows flex-between"},React.createElement("div",{id:"smartadmin-main-header",className:"flex-0 is-rainbow is-white-text p30"},React.createElement(LayoutHeader,{manifest:t})),React.createElement("div",{id:"smartadmin-main-container",className:"p20 flex-1"},React.createElement(SmartLayoutPagesContainer,{routes:r})),React.createElement("div",{id:"smartadmin-main-footer",className:"fs12 flex-0 flex-columns flex-between p20 mt60"},React.createElement(LayoutFooter,{manifest:t}))))};SmartAdminMainLayout.propTypes={className:PropTypes.string.isRequired,manifest:PropTypes.object.isRequired,routes:PropTypes.object.isRequired};var SmartAdminMainLayout$1=redux.compose(reactRouterDom.withRouter,reactRedux.connect(mapStateToProps$2))(SmartAdminMainLayout),SmartAdmin=function(e){var t=e.manifest,r=e.reducers,n=e.routes;Logger.debug("\n    **** Smart Admin Application Debug ****\n    NODE_ENV => ".concat(process.env.NODE_ENV,"\n    REACT_APP_VERSION => ").concat(t.version,"\n    REACT_APP_GRAPHQL_URI => ").concat(process.env.REACT_APP_GRAPHQL_URI,"\n  "));var o=redux.combineReducers(_objectSpread({},coreReducers,r)),a=configure(o),i=process.env.REACT_APP_GRAPHQL_URI,c=createClient(i,a).client;return React.createElement(reactRedux.Provider,{store:a},React.createElement(reactApollo.ApolloProvider,{client:c},React.createElement(reactRouterDom.BrowserRouter,null,React.createElement(SmartAdminMainLayout$1,{manifest:t,routes:n}))))};SmartAdmin.propTypes={manifest:PropTypes.object.isRequired,reducers:PropTypes.object.isRequired,routes:PropTypes.object.isRequired},module.exports=SmartAdmin;
